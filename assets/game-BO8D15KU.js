import"./modulepreload-polyfill-B5Qt9EMX.js";const l={currentDialogueID:null},r={dialogue:null,images:null,choices:null,characters:null,backgrounds:null,frames:null,meta:null};function d(t,n){const c=r[t];for(let o=0;o<c.length;o++)if(c[o].id===n)return c[o];return null}const e={doc:null,bg:null,charName:null,char1Img:null,char2Img:null,dialogueText:null,choicesDiv:null,continueInd:null};function b(){const t=document.querySelector("iframe");e.doc=t?t.contentDocument:document,e.bg=e.doc.getElementById("background"),e.charName=e.doc.getElementById("character-name"),e.char1Img=e.doc.getElementById("character1"),e.char2Img=e.doc.getElementById("character2"),e.dialogueText=e.doc.querySelector("#dialogue-box .text"),e.choicesDiv=e.doc.getElementById("choices"),e.continueInd=e.doc.getElementById("continue-indicator")}function u(t,n,c){let o;const a=c==="left"?e.char1Img:e.char2Img;if(t===null){e.charName.classList.add("hidden"),a.classList.add("hidden");return}else o=d("characters",t),e.charName.classList.remove("hidden");if(n===null)a.classList.add("hidden");else{const s=d("frames",o.frames[n]),f=d("images",s.imageID);a.src=`/game-data/images/${f.filename}`,a.classList.remove("hidden")}}function h(){const t=d("dialogue",l.currentDialogueID),n=d("backgrounds",t.backgroundID),c=d("images",n.imageID);e.bg.style.backgroundImage=`url(/game-data/images/${c.filename})`,e.bg.style.backgroundColor=n.bgColor,u(t.character1ID,t.character1FrameIndex,"left"),u(t.character2ID,t.character2FrameIndex,"right"),e.dialogueText.textContent=t.text,I();let o=!0;for(const a of t.choices){const s=d("choices",a);y(s.text,a),s.text.length>0&&(o=!1)}if(t.ownerCharacterID!==null){const a=d("characters",t.ownerCharacterID);e.charName.textContent=a.name,e.charName.classList.remove("hidden")}else e.charName.classList.add("hidden");if(o){if(t.choices.length>1)throw new Error(`All ${t.choices.length} dialogue choices are hidden`);e.continueInd.classList.remove("hidden")}else e.continueInd.classList.add("hidden")}function I(){e.choicesDiv.innerHTML=""}function y(t,n){const c=document.createElement("button");c.className="choice",c.type="button",c.textContent=t,c.dataset.id=n.toString(),t.length===0&&c.classList.add("hidden"),e.choicesDiv.append(c)}async function D(){const t=Object.keys(r),n=[];for(const o of t){console.log("fetching game data",o);const a=fetch(`/game-data/data/${o}.json`);n.push(a)}const c=await Promise.all(n);for(const o of c){const a=o.url.match(/game-data\/data\/(.+)\.json$/)[1],s=await o.json();r[a]=s}}const g=[];let m=!1;function v(t,n,c){m||E(),Array.isArray(n)||(n=[n]);for(const o of n)g.push({selector:t,eventName:o,handler:c})}function E(){e.doc.body.addEventListener("click",i.bind(null,"click")),e.doc.body.addEventListener("input",i.bind(null,"input")),e.doc.body.addEventListener("change",i.bind(null,"change")),e.doc.body.addEventListener("contextmenu",i.bind(null,"contextmenu")),e.doc.body.addEventListener("keyup",i.bind(null,"keyup")),e.doc.body.addEventListener("focusout",i.bind(null,"focusout")),e.doc.body.addEventListener("mouseover",i.bind(null,"mouseover")),e.doc.body.addEventListener("mousemove",i.bind(null,"mousemove")),e.doc.body.addEventListener("mouseout",i.bind(null,"mouseout")),m=!0}function i(t,n){const c=n.target;for(const o of g)o.eventName===t&&c.matches(o.selector)&&o.handler(n,c)}function L(){v("div#choices button.choice","click",n=>{const o=+n.target.dataset.id,a=d("choices",o);a.targetDialogueID!==null&&(l.currentDialogueID=a.targetDialogueID,h())}),e.doc.getElementById("dialogue-box").addEventListener("click",t),window.addEventListener("keypress",t);function t(n){if(n instanceof KeyboardEvent&&n.code!=="Space"&&n.code!=="Enter")return;const c=Array.from(e.doc.querySelectorAll("#choices button.choice"));c.length!==1||!c[0].classList.contains("hidden")||(c[0].click(),n.preventDefault())}}window.addEventListener("load",async()=>{await D(),l.currentDialogueID=0,b(),L(),h()});
