(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerPolicy&&(a.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?a.credentials="include":c.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(c){if(c.ep)return;c.ep=!0;const a=o(c);fetch(c.href,a)}})();const h={currentDialogueID:null},d={dialogue:null,images:null,choices:null,characters:null,backgrounds:null,frames:null,meta:null};function s(e,n){const o=d[e];for(let r=0;r<o.length;r++)if(o[r].id===n)return o[r];return null}const t={doc:null,bg:null,charName:null,char1Img:null,char2Img:null,dialogueText:null,choicesDiv:null,continueInd:null};function v(){const e=document.querySelector("iframe");t.doc=e?e.contentDocument:document,t.bg=t.doc.getElementById("background"),t.charName=t.doc.getElementById("character-name"),t.char1Img=t.doc.getElementById("character1"),t.char2Img=t.doc.getElementById("character2"),t.dialogueText=t.doc.querySelector("#dialogue-box .text"),t.choicesDiv=t.doc.getElementById("choices"),t.continueInd=t.doc.getElementById("continue-indicator")}function D(e){return JSON.parse(JSON.stringify(e))}function E(e,n){return e===null||Number.isNaN(e)||typeof e!="number"?n:e}function u(e){const n=window.location.protocol+"//"+window.location.host,o=new URL(n+window.__BASE__);return new URL(e,o).href}function f(e,n,o){let r;const c=o==="left"?t.char1Img:t.char2Img;if(e===null){t.charName.classList.add("hidden"),c.classList.add("hidden");return}else r=s("characters",e),t.charName.classList.remove("hidden");if(n===null)c.classList.add("hidden");else{const a=s("frames",r.frames[n]),l=s("images",a.imageID);c.src=u(`./game-data/images/${l.filename}`),c.classList.remove("hidden")}}function b(){const e=s("dialogue",h.currentDialogueID),n=s("backgrounds",e.backgroundID),o=s("images",n.imageID),r=u(`./game-data/images/${o.filename}`);t.bg.style.backgroundImage=`url(${r})`,t.bg.style.backgroundColor=n.bgColor,f(e.character1ID,e.character1FrameIndex,"left"),f(e.character2ID,e.character2FrameIndex,"right"),t.dialogueText.textContent=e.text,y();let c=!0;for(const a of e.choices){const l=s("choices",a);I(l.text,a),l.text.length>0&&(c=!1)}if(e.ownerCharacterID!==null){const a=s("characters",e.ownerCharacterID);t.charName.textContent=a.name,t.charName.classList.remove("hidden")}else t.charName.classList.add("hidden");if(c){if(e.choices.length>1)throw new Error(`All ${e.choices.length} dialogue choices are hidden`);t.continueInd.classList.remove("hidden")}else t.continueInd.classList.add("hidden")}function y(){t.choicesDiv.innerHTML=""}function I(e,n){const o=document.createElement("button");o.className="choice",o.type="button",o.textContent=e,o.dataset.id=n.toString(),e.length===0&&o.classList.add("hidden"),t.choicesDiv.append(o)}async function w(){const e=Object.keys(d),n=[];for(const r of e){const c=fetch(u(`./game-data/data/${r}.json`));n.push(c)}const o=await Promise.all(n);for(const r of o){const c=r.url.match(/game-data\/data\/(.+)\.json$/)[1],a=await r.json();d[c]=a}}const m=[];let g=!1;function p(e,n,o){g||L(),Array.isArray(n)||(n=[n]);for(const r of n)m.push({selector:e,eventName:r,handler:o})}function L(){t.doc.body.addEventListener("click",i.bind(null,"click")),t.doc.body.addEventListener("input",i.bind(null,"input")),t.doc.body.addEventListener("change",i.bind(null,"change")),t.doc.body.addEventListener("contextmenu",i.bind(null,"contextmenu")),t.doc.body.addEventListener("keyup",i.bind(null,"keyup")),t.doc.body.addEventListener("focusout",i.bind(null,"focusout")),t.doc.body.addEventListener("mouseover",i.bind(null,"mouseover")),t.doc.body.addEventListener("mousemove",i.bind(null,"mousemove")),t.doc.body.addEventListener("mouseout",i.bind(null,"mouseout")),g=!0}function i(e,n){const o=n.target;for(const r of m)r.eventName===e&&o.matches(r.selector)&&r.handler(n,o)}function x(){p("div#choices button.choice","click",n=>{const r=+n.target.dataset.id,c=s("choices",r);c.targetDialogueID!==null&&(h.currentDialogueID=c.targetDialogueID,b())}),t.doc.getElementById("dialogue-box").addEventListener("click",e),window.addEventListener("keypress",e);function e(n){if(n instanceof KeyboardEvent&&n.code!=="Space"&&n.code!=="Enter")return;const o=Array.from(t.doc.querySelectorAll("#choices button.choice"));o.length!==1||!o[0].classList.contains("hidden")||(o[0].click(),n.preventDefault())}}export{x as a,d as b,p as c,b as d,D as e,s as g,v as i,w as l,E as n,h as s};
