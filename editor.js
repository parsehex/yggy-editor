import{g as x,b as v,s as N,c as Ze,d as et,n as Q,l as tt,e as nt,f as at,i as it,a as rt}from"./assets/events-BvDii-8u.js";function ke(e,i){Array.isArray(e)||(e=[e]);for(const a of e)a.disabled=i}function q(e){return document.querySelector(e)}function $(e){return document.createElement(e)}const w={btnBack:q("button#nav-back"),btnNext:q("button#nav-next"),btnPush:q("button#push"),btnPull:q("button#pull"),btnSave:q("button#save"),btnClear:q("button#clear"),dialogueTab:{dialogue:q("#dialogue-tab textarea.dialogue"),choices:q("#dialogue-tab div.choices"),characters:q("#dialogue-tab div.characters"),background:q("#dialogue-tab select.background")},charactersTab:{list:q("#characters-tab div.list")},backgroundsTab:{list:q("#backgrounds-tab div.list")},imagesTab:{list:q("#images-tab div.list"),previewSelect:q("#images-tab .image-file-preview-select"),previewImage:q("#images-tab #image-file-preview"),uploadFileName:q("#images-tab #upload input.name"),fileInput:q('#images-tab input[type="file"]'),uploadButton:q("#images-tab #upload button.submit")},tree:{list:q("#tree-tab > ul"),btnUndo:q("#tree-tab > div > button.undo")}};function Ge(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var se,Se;function ot(){if(Se)return se;Se=1,t.notEqual=i,t.notOk=a,t.equal=e,t.ok=t,se=t;function e(n,r,o){t(n==r,o)}function i(n,r,o){t(n!=r,o)}function a(n,r){t(!n,r)}function t(n,r){if(!n)throw new Error(r||"AssertionError")}return se}var le,Ce;function ct(){return Ce||(Ce=1,le=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"]),le}var ue,Ee;function st(){if(Ee)return ue;Ee=1;var e=ct(),i=e.length,a=1,t=3,n=8;ue=r;function r(l,s){var d=l.nodeType,I=l.nodeName;d===a&&o(l,s),(d===t||d===n)&&s.nodeValue!==l.nodeValue&&(s.nodeValue=l.nodeValue),I==="INPUT"?u(l,s):I==="OPTION"?c(l,s):I==="TEXTAREA"&&f(l,s),g(l,s)}function o(l,s){for(var d=s.attributes,I=l.attributes,y=null,C=null,E=null,T=null,L=null,K=I.length-1;K>=0;--K)L=I[K],T=L.name,y=L.namespaceURI,C=L.value,y?(T=L.localName||T,E=s.getAttributeNS(y,T),E!==C&&s.setAttributeNS(y,T,C)):s.hasAttribute(T)?(E=s.getAttribute(T),E!==C&&(C==="null"||C==="undefined"?s.removeAttribute(T):s.setAttribute(T,C))):s.setAttribute(T,C);for(var M=d.length-1;M>=0;--M)L=d[M],L.specified!==!1&&(T=L.name,y=L.namespaceURI,y?(T=L.localName||T,l.hasAttributeNS(y,T)||s.removeAttributeNS(y,T)):l.hasAttributeNS(null,T)||s.removeAttribute(T))}function g(l,s){for(var d=0;d<i;d++){var I=e[d];l[I]?s[I]=l[I]:s[I]&&(s[I]=void 0)}}function c(l,s){D(l,s,"selected")}function u(l,s){var d=l.value,I=s.value;D(l,s,"checked"),D(l,s,"disabled"),l.indeterminate!==s.indeterminate&&(s.indeterminate=l.indeterminate),s.type!=="file"&&(d!==I&&(s.setAttribute("value",d),s.value=d),d==="null"&&(s.value="",s.removeAttribute("value")),l.hasAttributeNS(null,"value")?s.type==="range"&&(s.value=d):s.removeAttribute("value"))}function f(l,s){var d=l.value;if(d!==s.value&&(s.value=d),s.firstChild&&s.firstChild.nodeValue!==d){if(d===""&&s.firstChild.nodeValue===s.placeholder)return;s.firstChild.nodeValue=d}}function D(l,s,d){l[d]!==s[d]&&(s[d]=l[d],l[d]?s.setAttribute(d,""):s.removeAttribute(d))}return ue}var de,$e;function lt(){if($e)return de;$e=1;var e=ot(),i=st(),a=3;de=t;function t(c,u,f){return e.equal(typeof c,"object","nanomorph: oldTree should be an object"),e.equal(typeof u,"object","nanomorph: newTree should be an object"),f&&f.childrenOnly?(o(u,c),c):(e.notEqual(u.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),n(u,c))}function n(c,u){return u?c?c.isSameNode&&c.isSameNode(u)?u:c.tagName!==u.tagName||r(c)!==r(u)?c:(i(c,u),o(c,u),u):null:c}function r(c){return c.dataset?c.dataset.nanomorphComponentId:void 0}function o(c,u){for(var f,D,l,s,d=0,I=0;f=u.childNodes[I],D=c.childNodes[I-d],!(!f&&!D);I++)if(!D)u.removeChild(f),I--;else if(!f)u.appendChild(D),d++;else if(g(D,f))l=n(D,f),l!==f&&(u.replaceChild(l,f),d++);else{s=null;for(var y=I;y<u.childNodes.length;y++)if(g(u.childNodes[y],D)){s=u.childNodes[y];break}s?(l=n(D,s),l!==s&&d++,u.insertBefore(l,f)):!D.id&&!f.id?(l=n(D,f),l!==f&&(u.replaceChild(l,f),d++)):(u.insertBefore(D,f),d++)}}function g(c,u){return c.id?c.id===u.id:c.isSameNode?c.isSameNode(u):c.tagName!==u.tagName?!1:c.type===a?c.nodeValue===u.nodeValue:!1}return de}var ut=lt();const ee=Ge(ut);function dt(e){const i=w.dialogueTab.choices.cloneNode(),{choices:a}=e;i.innerHTML="";for(const r of a){const o=x("choices",r),g=$("div");g.className="choice",g.dataset.id=r.toString();const c=$("textarea");c.className="text",c.cols=30,c.placeholder="Choice text",c.value=o.text,g.append(c);const u=$("button");if(u.className="delete",u.type="button",u.textContent="X",u.title="Delete choice",g.append(u),o.targetDialogueID===null){const f=$("button");f.className="create-dialogue",f.type="button",f.textContent="+ Dialogue",f.title="Attach a new dialogue to this choice",g.append(f)}else{const f=$("button");f.className="go-to-dialogue",f.type="button",f.textContent="Go",f.title="Go to linked dialogue",g.append(f)}i.append(g)}const t=$("div"),n=$("button");n.className="create",n.type="button",n.textContent="+ Choice",n.title="Add choice",t.append(n),i.append(t),ee(w.dialogueTab.choices,i)}function Y(e,i,a){const t=$("select");t.className=e;for(const n of i){if(!n)continue;const r=$("option");r.value=n.value!==void 0?n.value:n.text.toLowerCase(),r.textContent=n.text,t.append(r)}return a!==void 0&&(t.value=a+""),t}function ft(e,i){const a=$("span");return a.className=e,a.textContent=i,a}function gt(e){const i=w.dialogueTab.characters.cloneNode(),a=x("characters",e.character1ID),t=Ae("1",a,e.character1FrameIndex,e.ownerCharacterID);i.append(t);const n=x("characters",e.character2ID),r=Ae("2",n,e.character2FrameIndex,e.ownerCharacterID);i.append(r),ee(w.dialogueTab.characters,i)}function Ae(e,i,a,t,n){const r=i===null?"none":i.id,o=$("div");o.className="character",o.dataset.id=r.toString();const g=v.characters.map(d=>({text:d.name,value:d.id.toString()}));g.unshift({text:"None"});const c=ft("","Character "+e+":"),u=Y("name",g,r);if(o.append(c),o.append(u),i===null)return o;const f=i.frames.map((d,I)=>({text:x("frames",d).name,value:I.toString()}));f.unshift({text:"None"});const D=Y("frame",f,a);o.append(D);const l=$("label");l.className="owner",l.htmlFor="dialogue-owner-ch"+r,l.textContent="Talking:",o.append(l);const s=$("input");return s.className="owner",s.type="checkbox",s.checked=t===r,s.id="dialogue-owner-ch"+r,o.append(s),o}function ht(e){const i=x("backgrounds",e.backgroundID);w.dialogueTab.background.innerHTML="";const a=v.backgrounds;for(const t of a){const n=$("option");n.value=t.id.toString(),n.textContent=t.name,w.dialogueTab.background.append(n)}w.dialogueTab.background.value=i.id.toString()}function mt(){const e=x("dialogue",N.currentDialogueID);w.dialogueTab.dialogue.value=e.text,dt(e),gt(e),ht(e)}function pt(){const e=w.charactersTab.list.cloneNode(),i=v.characters;e.innerHTML="";const a=v.images.map(t=>({text:t.name,value:t.id.toString()}));for(const t of i){const n=$("div");n.className="character",n.dataset.id=t.id.toString(),e.append(n);const r=$("input");if(r.className="name",r.type="text",r.value=t.name,n.append(r),i.length>1){const c=$("button");c.className="delete",c.type="button",c.textContent="X",c.title="Delete character",n.append(c)}for(let c=0;c<t.frames.length;c++){const u=t.frames[c],f=x("frames",u),D=$("div");D.className="frame",D.dataset.id=f.id.toString(),n.append(D);let l;if(c===0)l=$("span"),l.textContent=f.name;else{l=$("input");const I=l;I.type="text",I.value=f.name,I.placeholder="Frame name"}l.className="name",D.append(l);const s=Y("image",a,f.imageID);if(D.append(s),c===0)continue;const d=$("button");d.className="delete",d.type="button",d.textContent="X",D.append(d)}const o=$("div");o.className="frame",n.append(o);const g=$("button");g.className="create",g.type="button",g.textContent="+ Frame",o.append(g)}ee(w.charactersTab.list,e)}function vt(){const e=w.backgroundsTab.list.cloneNode(),i=v.backgrounds;e.innerHTML="";const a=v.images.map(t=>({text:t.name,value:t.id.toString()}));for(const t of i){const n=$("div");n.className="background",n.dataset.id=t.id.toString();const r=$("input");r.className="name",r.type="text",r.value=t.name,n.append(r);const o=Y("image",a,t.imageID);n.append(o);const g=$("input");if(g.className="bg-color",g.type="text",g.value=t.bgColor,g.title="Color of the background behind image",n.append(g),i.length>1){const c=$("button");c.className="delete",c.type="button",c.textContent="X",c.title="Delete background",n.append(c)}e.append(n)}ee(w.backgroundsTab.list,e)}function Z(e,i,a){const t=$("button");return t.type="button",t.className=e,t.textContent=i,a&&(t.title=a),t}async function bt(){const i=await(await fetch("/api/get-images")).json(),a=w.imagesTab.list.cloneNode(),t=v.images;a.innerHTML="";const n=i.map(g=>({text:g}));for(const g of t){const c=$("div");c.className="image",c.dataset.id=g.id.toString();const u=$("img");u.className="image-preview",u.src="/game-data/images/"+g.filename,c.append(u);const f=$("input");f.className="name",f.type="text",f.value=g.name,c.append(f);const D=Y("image-file",n,g.filename);if(c.append(D),t.length>1){const l=Z("delete","X");l.title="Delete image",c.append(l)}a.append(c)}const r=w.imagesTab.previewSelect.value||"none";n.unshift({text:"None"});const o=Y("image-file-preview-select",n);w.imagesTab.previewSelect.replaceWith(o),i.indexOf(r)>-1?o.value=r:o.value="none",ee(w.imagesTab.list,a)}var fe,Oe;function Dt(){if(Oe)return fe;Oe=1,fe=i;var e={class:"className",for:"htmlFor","http-equiv":"httpEquiv"};function i(a){return function(t,n,r){for(var o in n)o in e&&(n[e[o]]=n[o],delete n[o]);return a(t,n,r)}}return fe}var ge,Le;function It(){if(Le)return ge;Le=1;var e=Dt(),i=0,a=1,t=2,n=3,r=4,o=5,g=6,c=7,u=8,f=9,D=10,l=11,s=12,d=13;ge=function(E,T){T||(T={});var L=T.concat||function(M,h){return String(M)+String(h)};return T.attrToProp!==!1&&(E=e(E)),function(M){for(var h=a,p="",Qe=arguments.length,S=[],k=0;k<M.length;k++)if(k<Qe-1){var re=arguments[k+1],R=Te(M[k]),H=h;H===D&&(H=u),H===f&&(H=u),H===c&&(H=u),H===r&&(H=o),H===t?p==="/"?(R.push([t,"/",re]),p=""):R.push([t,re]):H===d&&T.comments?p+=String(re):H!==d&&R.push([i,H,re]),S.push.apply(S,R)}else S.push.apply(S,Te(M[k]));for(var P=[null,{},[]],_=[[P,-1]],k=0;k<S.length;k++){var O=_[_.length-1][0],R=S[k],G=R[0];if(G===t&&/^\//.test(R[1])){var ce=_[_.length-1][1];_.length>1&&(_.pop(),_[_.length-1][0][2][ce]=E(O[0],O[1],O[2].length?O[2]:void 0))}else if(G===t){var xe=[R[1],{},[]];O[2].push(xe),_.push([xe,O[2].length-1])}else if(G===o||G===i&&R[1]===o){for(var V="",te;k<S.length;k++)if(S[k][0]===o)V=L(V,S[k][1]);else if(S[k][0]===i&&S[k][1]===o)if(typeof S[k][2]=="object"&&!V)for(te in S[k][2])S[k][2].hasOwnProperty(te)&&!O[1][te]&&(O[1][te]=S[k][2][te]);else V=L(V,S[k][2]);else break;S[k][0]===l&&k++;for(var Ye=k;k<S.length;k++)if(S[k][0]===u||S[k][0]===o)O[1][V]?S[k][1]===""||(O[1][V]=L(O[1][V],S[k][1])):O[1][V]=K(S[k][1]);else if(S[k][0]===i&&(S[k][1]===u||S[k][1]===o))O[1][V]?S[k][2]===""||(O[1][V]=L(O[1][V],S[k][2])):O[1][V]=K(S[k][2]);else{V.length&&!O[1][V]&&k===Ye&&(S[k][0]===n||S[k][0]===s)&&(O[1][V]=V.toLowerCase()),S[k][0]===n&&k--;break}}else if(G===o)O[1][R[1]]=!0;else if(G===i&&R[1]===o)O[1][R[2]]=!0;else if(G===n){if(C(O[0])&&_.length){var ce=_[_.length-1][1];_.pop(),_[_.length-1][0][2][ce]=E(O[0],O[1],O[2].length?O[2]:void 0)}}else if(G===i&&R[1]===a)R[2]===void 0||R[2]===null?R[2]="":R[2]||(R[2]=L("",R[2])),Array.isArray(R[2][0])?O[2].push.apply(O[2],R[2]):O[2].push(R[2]);else if(G===a)O[2].push(R[1]);else if(!(G===l||G===s))throw new Error("unhandled: "+G)}if(P[2].length>1&&/^\s*$/.test(P[2][0])&&P[2].shift(),P[2].length>2||P[2].length===2&&/\S/.test(P[2][1])){if(T.createFragment)return T.createFragment(P[2]);throw new Error("multiple root elements must be wrapped in an enclosing tag")}return Array.isArray(P[2][0])&&typeof P[2][0][0]=="string"&&Array.isArray(P[2][0][2])&&(P[2][0]=E(P[2][0][0],P[2][0][1],P[2][0][2])),P[2][0];function Te(we){var B=[];h===c&&(h=r);for(var oe=0;oe<we.length;oe++){var F=we.charAt(oe);h===a&&F==="<"?(p.length&&B.push([a,p]),p="",h=t):F===">"&&!I(h)&&h!==d?(h===t&&p.length?B.push([t,p]):h===o?B.push([o,p]):h===u&&p.length&&B.push([u,p]),B.push([n]),p="",h=a):h===d&&/-$/.test(p)&&F==="-"?(T.comments&&B.push([u,p.substr(0,p.length-1)]),p="",h=a):h===t&&/^!--$/.test(p)?(T.comments&&B.push([t,p],[o,"comment"],[l]),p=F,h=d):h===a||h===d?p+=F:h===t&&F==="/"&&p.length||(h===t&&/\s/.test(F)?(p.length&&B.push([t,p]),p="",h=r):h===t?p+=F:h===r&&/[^\s"'=/]/.test(F)?(h=o,p=F):h===r&&/\s/.test(F)?(p.length&&B.push([o,p]),B.push([s])):h===o&&/\s/.test(F)?(B.push([o,p]),p="",h=g):h===o&&F==="="?(B.push([o,p],[l]),p="",h=c):h===o?p+=F:(h===g||h===r)&&F==="="?(B.push([l]),h=c):(h===g||h===r)&&!/\s/.test(F)?(B.push([s]),/[\w-]/.test(F)?(p+=F,h=o):h=r):h===c&&F==='"'?h=D:h===c&&F==="'"?h=f:h===D&&F==='"'?(B.push([u,p],[s]),p="",h=r):h===f&&F==="'"?(B.push([u,p],[s]),p="",h=r):h===c&&!/\s/.test(F)?(h=u,oe--):h===u&&/\s/.test(F)?(B.push([u,p],[s]),p="",h=r):(h===u||h===f||h===D)&&(p+=F))}return h===a&&p.length?(B.push([a,p]),p=""):h===u&&p.length?(B.push([u,p]),p=""):h===D&&p.length?(B.push([u,p]),p=""):h===f&&p.length?(B.push([u,p]),p=""):h===o&&(B.push([o,p]),p=""),B}};function K(M){return typeof M=="function"||typeof M=="string"||M&&typeof M=="object"||M==null?M:L("",M)}};function I(E){return E===f||E===D}var y=RegExp("^("+["area","base","basefont","bgsound","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr","!--","animate","animateTransform","circle","cursor","desc","ellipse","feBlend","feColorMatrix","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","font-face-format","font-face-name","font-face-uri","glyph","glyphRef","hkern","image","line","missing-glyph","mpath","path","polygon","polyline","rect","set","stop","tref","use","view","vkern"].join("|")+")(?:[.#][a-zA-Z0-9-ï¿¿_:-]+)*$");function C(E){return y.test(E)}return ge}var he,Fe;function kt(){if(Fe)return he;Fe=1;var e=/\n[\s]+$/,i=/^\n[\s]+/,a=/[\s]+$/,t=/^[\s]+/,n=/[\n\s]+/g,r=["a","abbr","b","bdi","bdo","br","cite","data","dfn","em","i","kbd","mark","q","rp","rt","rtc","ruby","s","amp","small","span","strong","sub","sup","time","u","var","wbr"],o=["code","pre","textarea"];return he=function g(c,u){if(Array.isArray(u))for(var f=c.nodeName.toLowerCase(),D=!1,l,s,d=0,I=u.length;d<I;d++){var y=u[d];if(Array.isArray(y)){g(c,y);continue}(typeof y=="number"||typeof y=="boolean"||typeof y=="function"||y instanceof Date||y instanceof RegExp)&&(y=y.toString());var C=c.childNodes[c.childNodes.length-1];if(typeof y=="string")D=!0,C&&C.nodeName==="#text"?C.nodeValue+=y:(y=c.ownerDocument.createTextNode(y),c.appendChild(y),C=y),d===I-1&&(D=!1,r.indexOf(f)===-1&&o.indexOf(f)===-1?(l=C.nodeValue.replace(i,"").replace(a,"").replace(e,"").replace(n," "),l===""?c.removeChild(C):C.nodeValue=l):o.indexOf(f)===-1&&(s=d===0?"":" ",l=C.nodeValue.replace(i,s).replace(t," ").replace(a,"").replace(e,"").replace(n," "),C.nodeValue=l));else if(y&&y.nodeType){D&&(D=!1,r.indexOf(f)===-1&&o.indexOf(f)===-1?(l=C.nodeValue.replace(i,"").replace(e," ").replace(n," "),l===""?c.removeChild(C):C.nodeValue=l):o.indexOf(f)===-1&&(l=C.nodeValue.replace(t," ").replace(i,"").replace(e," ").replace(n," "),C.nodeValue=l));var E=y.nodeName;E&&(f=E.toLowerCase()),c.appendChild(y)}}},he}var me,Re;function yt(){return Re||(Re=1,me=["svg","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"]),me}var pe,Be;function xt(){return Be||(Be=1,pe=["async","autofocus","autoplay","checked","controls","default","defaultchecked","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","novalidate","open","playsinline","readonly","required","reversed","selected"]),pe}var ve,qe;function Tt(){return qe||(qe=1,ve=["indeterminate"]),ve}var be,Me;function wt(){if(Me)return be;Me=1;var e=It(),i=kt(),a=yt(),t=xt(),n=Tt(),r="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xlink",g="!--";return be=function(c){function u(l,s,d){var I;a.indexOf(l)!==-1&&(s.namespace=r);var y=!1;s.namespace&&(y=s.namespace,delete s.namespace);var C=!1;if(s.is&&(C=s.is,delete s.is),y)C?I=c.createElementNS(y,l,{is:C}):I=c.createElementNS(y,l);else{if(l===g)return c.createComment(s.comment);C?I=c.createElement(l,{is:C}):I=c.createElement(l)}for(var E in s)if(s.hasOwnProperty(E)){var T=E.toLowerCase(),L=s[E];if(T==="classname"&&(T="class",E="class"),E==="htmlFor"&&(E="for"),t.indexOf(T)!==-1){if(String(L)==="true")L=T;else if(String(L)==="false")continue}T.slice(0,2)==="on"||n.indexOf(T)!==-1?I[E]=L:y?E==="xlink:href"?I.setAttributeNS(o,E,L):/^xmlns($|:)/i.test(E)||I.setAttributeNS(null,E,L):I.setAttribute(E,L)}return i(I,d),I}function f(l){for(var s=c.createDocumentFragment(),d=0;d<l.length;d++)l[d]!=null&&(Array.isArray(l[d])?s.appendChild(f(l[d])):(typeof l[d]=="string"&&(l[d]=c.createTextNode(l[d])),s.appendChild(l[d])));return s}var D=e(u,{comments:!0,createFragment:f});return D.default=D,D.createComment=u,D},be}var De,Ne;function St(){return Ne||(Ne=1,De=wt()(document)),De}var Ct=St();const z=Ge(Ct),m={devMode:location.href.includes("8080"),history:[],currentHistoryIndex:-1,tree:{collapsed:{dialogue:[],choices:[]},linking:{dialogueID:null,srcDialogueID:null,choiceID:null,finalized:!1}}},je="Click to toggle collapse";function Et(){const e=v.dialogue[0],a=z`<ul class="tree font-sans">
		${We(e,new Set)}
	</ul>`;ee(w.tree.list,a),ke(w.tree.btnUndo,!m.tree.linking.finalized||m.tree.linking.dialogueID===null||m.tree.linking.choiceID===null)}function We(e,i){const a=i.has(e.id);i.add(e.id);const t=N.currentDialogueID===e.id,n=m.tree.collapsed.dialogue.includes(e.id),r=["dialogue",a?"reference":"",t?"active":"",n?"collapsed":""].filter(Boolean).join(" "),o=["text",t?"font-bold":"",a?"italic":""].filter(Boolean).join(" ");return z`
		<li id=${`dialogue-${e.id}`} class=${r} data-id=${e.id}>
			<div class="content flex items-center">
				<span class=${o} title=${je}>${e.text}</span>
				${Ve(e.character1ID)} ${Ve(e.character2ID)}
				${a?"":z` ${At()} ${Ot(e.id)} `}
			</div>

			${!a&&e.choices.length?z`
						<ul class="choices">
							${e.choices.map(g=>$t(x("choices",g),i))}
						</ul>
				  `:""}
		</li>
	`}function Ve(e){if(e===null)return"";const i=x("characters",e);return z`<span class="character">${i.name}</span>`}function $t(e,i){const a=e.text.length===0,t=a?"(cycle dialogue)":e.text,n=["choice",m.tree.collapsed.choices.includes(e.id)?"collapsed":"",a?"cycle-dialogue":""].filter(Boolean).join(" "),r=["text",a?"italic text-gray-700":""].filter(Boolean).join(" ");return z`
		<li id=${`choice-${e.id}`} class=${n} data-id=${e.id}>
			<div class="content flex items-center">
				<span class=${r} title=${je}>${t}</span>
				${Lt(e.id)}
				${e.targetDialogueID===null?Z("create-dialogue","+ Dialogue"):Z("unlink","Unlink","Remove dialogue link")}
			</div>

			${e.targetDialogueID!==null?z`
						<ul>
							${We(x("dialogue",e.targetDialogueID),i)}
						</ul>
				  `:""}
		</li>
	`}function At(){return Z("go-to","Go","Go to dialogue in preview")}function Ot(e){const i=Z("link","Link","Link dialogue to choice");return!m.tree.linking.finalized&&m.tree.linking.dialogueID===e&&i.classList.add("active"),i}function Lt(e){const i=Z("link","Link","Link choice to dialogue");return!m.tree.linking.finalized&&m.tree.linking.choiceID===e&&i.classList.add("active"),i}function W(){const e=performance.now(),a=document.querySelector(".tab.active").id.toLowerCase();if(a.indexOf("dialogue")>-1?mt():a.indexOf("characters")>-1?pt():a.indexOf("tree")>-1?Et():a.indexOf("backgrounds")>-1?vt():a.indexOf("images")>-1&&bt(),ke(w.btnBack,m.currentHistoryIndex===0),ke(w.btnNext,m.currentHistoryIndex===m.history.length-1),m.devMode){const t=performance.now()-e;document.getElementById("update-time").textContent=`${t.toFixed(3)}ms`}}function Ft(){const e=m.currentHistoryIndex+1;e>=m.history.length||(N.currentDialogueID=m.history[e],m.currentHistoryIndex++)}function Rt(){const e=m.currentHistoryIndex-1;e<0||(N.currentDialogueID=m.history[e],m.currentHistoryIndex--)}function ze(e){m.currentHistoryIndex<m.history.length-1&&(m.history.length=m.currentHistoryIndex+1),N.currentDialogueID=e,m.history.push(e),m.currentHistoryIndex++}function Bt(){((i,a,t)=>{Ze(i,a,(n,r)=>{setTimeout(()=>{t(n,r)},0)})})("div#choices button.choice","click",i=>{ze(N.currentDialogueID),W()})}function A(){setTimeout(()=>{et(),W()},0)}const Ue=[];let Xe=!1;function b(e,i,a){Xe||qt(),Array.isArray(i)||(i=[i]);for(const t of i)Ue.push({selector:e,eventName:t,handler:a})}function qt(){document.body.addEventListener("click",j.bind(null,"click")),document.body.addEventListener("input",j.bind(null,"input")),document.body.addEventListener("change",j.bind(null,"change")),document.body.addEventListener("contextmenu",j.bind(null,"contextmenu")),document.body.addEventListener("keyup",j.bind(null,"keyup")),document.body.addEventListener("focusout",j.bind(null,"focusout")),document.body.addEventListener("mouseover",j.bind(null,"mouseover")),document.body.addEventListener("mousemove",j.bind(null,"mousemove")),document.body.addEventListener("mouseout",j.bind(null,"mouseout")),Xe=!0}function j(e,i){const a=i.target;for(const t of Ue)t.eventName===e&&a.matches(t.selector)&&t.handler(i,a);i.stopImmediatePropagation()}function ne(e){switch(e){case"backgrounds":return v.backgrounds[0];case"images":return v.images[0];case"characters":return v.characters[0]}}function Mt(e){const i=x("choices",e);v.choices.splice(v.choices.indexOf(i),1);for(const t of v.dialogue)t.choices.indexOf(e)>-1&&t.choices.splice(t.choices.indexOf(e),1);const a=m.tree.collapsed.choices.indexOf(i.id);a>-1&&m.tree.collapsed.choices.splice(a,1)}function Nt(e){const i=x("characters",e);v.characters.splice(v.characters.indexOf(i),1);const a=ne("characters");for(const t of v.dialogue)t.character1ID===e&&(t.character1ID=a.id,t.character1FrameIndex=0),t.character2ID===e&&(t.character2ID=a.id,t.character2FrameIndex=0)}function Vt(e){const i=x("backgrounds",e);v.backgrounds.splice(v.backgrounds.indexOf(i),1);const a=v.backgrounds[0].id;for(const t of v.dialogue)t.backgroundID===e&&(t.backgroundID=a)}function Pt(e){const i=x("images",e);v.images.splice(v.images.indexOf(i),1);const a=v.images[0].id;for(const t of v.backgrounds)t.imageID===e&&(t.imageID=a);for(const t of v.frames)t.imageID===e&&(t.imageID=a)}function _t(e){const i=x("dialogue",e);v.dialogue.splice(v.dialogue.indexOf(i),1)}function Ht(e){const i=x("frames",e),a=[];let t=!1;for(const n of v.characters){const r=n.frames.indexOf(e);if(r===0){t=!0;break}else r>0&&a.push(n)}if(!t){for(const n of a)n.frames.splice(n.frames.indexOf(e),1);v.frames.splice(v.frames.indexOf(i),1)}}const U={choice:Mt,character:Nt,background:Vt,image:Pt,dialogue:_t,frame:Ht},ae={};(()=>{const e=Object.keys(v);e.splice(e.indexOf("meta"),1);for(const i of e)ae[i]=[]})();function J(e){let i=Math.floor(Math.random()*9999999999);return ae[e].indexOf(i)>-1&&(i=J(e)),ae[e].push(i),i}function Gt(){const e=Object.keys(ae);for(const i of e)for(const a of v[i])ae[i].push(a.id)}function jt(e){console.log(e);const i={id:J("dialogue"),text:"Dialogue text",choices:[],backgroundID:Q(e.backgroundID,ne("backgrounds").id),character1ID:Q(e.character1ID,ne("characters").id),character1FrameIndex:Q(e.character1FrameIndex,0),character2ID:Q(e.character2ID,null),character2FrameIndex:Q(e.character2FrameIndex,null),ownerCharacterID:Q(e.ownerCharacterID,ne("characters").id)};return v.dialogue.push(i),i}function Wt(){const e={id:J("choices"),text:"Choice text",targetDialogueID:null};return v.choices.push(e),e}function zt(){const e=Je(),i={id:J("characters"),name:"New Character",frames:[e.id]};return v.characters.push(i),i}function Je(e){const i={id:J("frames"),name:e||"Default frame",imageID:ne("images").id};return v.frames.push(i),i}function Ut(){const e={id:J("images"),name:"New Image",filename:""};return v.images.push(e),e}const X={dialogue:jt,choice:Wt,character:zt,frame:Je,image:Ut};function Xt(){const e="#dialogue-tab";b(`${e} textarea.dialogue`,"input",(i,a)=>{const t=x("dialogue",N.currentDialogueID);t.text=a.value,A()}),b(`${e} div.choices textarea.text`,"input",(i,a)=>{const t=+a.closest("div.choice").dataset.id,n=x("choices",t);n.text=a.value,A()}),b(`${e} div.choices button.create`,"click",()=>{const i=x("dialogue",N.currentDialogueID),a=X.choice();i.choices.push(a.id),A()}),b(`${e} div.choices button.delete`,"click",(i,a)=>{const t=+a.closest("div.choice").dataset.id;U.choice(t),A()}),b(`${e} div.choices button.create-dialogue`,"click",(i,a)=>{const t=x("dialogue",N.currentDialogueID),n=+a.closest("div.choice").dataset.id,r=x("choices",n),o=X.dialogue(t);r.targetDialogueID=o.id,A()}),b(`${e} div.choices button.go-to-dialogue`,"click",(i,a)=>{const t=+a.closest("div.choice").dataset.id,n=x("choices",t);N.currentDialogueID!==n.targetDialogueID&&(N.currentDialogueID=n.targetDialogueID,A())}),b(`${e} div.characters .character select.name`,"click",(i,a)=>{const t=a.closest("div.character").matches(":first-of-type"),n=x("dialogue",N.currentDialogueID),r=+a.closest("div.character").dataset.id,o=a.value;let g,c;if(o==="none"?(g=null,c=null):(g=+o,c=0),g!==null&&(t&&g===n.character2ID||!t&&g===n.character1ID)){const u=t?n.character1ID:n.character2ID;a.value=u===null?"none":u.toString();return}g!==null&&n.ownerCharacterID===null&&n.character1ID===null&&n.character2ID===null&&(n.ownerCharacterID=g),t?(n.character1ID=g,n.character1FrameIndex=c):(n.character2ID=g,n.character2FrameIndex=c),o==="none"&&r===n.ownerCharacterID&&(n.ownerCharacterID=null),o==="none"&&n.ownerCharacterID===null&&(n.character1ID!==null||n.character2ID!==null)&&(n.character1ID!==null?n.ownerCharacterID=n.character1ID:n.character2ID!==null&&(n.ownerCharacterID=n.character2ID)),A()}),b(`${e} div.characters .character select.frame`,"click",(i,a)=>{const t=a.closest("div.character").matches(":first-of-type"),n=x("dialogue",N.currentDialogueID),r=a.value;let o;r==="none"?o=null:o=+r,t?n.character1FrameIndex=o:n.character2FrameIndex=o,A()}),b(`${e} div.characters .character input.owner`,"change",(i,a)=>{const t=x("dialogue",N.currentDialogueID),n=a.closest(".character").dataset.id;t.ownerCharacterID=n==="none"?null:+n,A()}),b(`${e} select.background`,"click",(i,a)=>{const t=x("dialogue",N.currentDialogueID),n=+a.value;t.backgroundID=n,A()})}function Jt(){const e="#characters-tab";b(`${e} button.create`,"click",()=>{X.character(),W()}),b(`${e} div.character > button.delete`,"click",(i,a)=>{const t=+a.closest("div.character").dataset.id;U.character(t),A()}),b(`${e} div.character > input.name`,"input",(i,a)=>{const t=+a.closest("div.character").dataset.id,n=x("characters",t);n.name=a.value,A()}),b(`${e} div.frame > button.create`,"click",(i,a)=>{const t=+a.closest("div.character").dataset.id,n=x("characters",t),r=X.frame("New frame");n.frames.push(r.id),A()}),b(`${e} div.frame > input.name`,"input",(i,a)=>{const t=+a.closest("div.frame").dataset.id,n=x("frames",t);n.name=a.value,A()}),b(`${e} div.frame > select.image`,"change",(i,a)=>{const t=+a.closest("div.frame").dataset.id,n=+a.value,r=x("frames",t);r.imageID=n,A()}),b(`${e} div.frame > button.delete`,"click",(i,a)=>{const t=+a.closest("div.frame").dataset.id;U.frame(t),A()})}function Kt(){const e="#backgrounds-tab";b(`${e} button.create`,"click",()=>{const i=J("backgrounds");v.backgrounds.push({id:i,name:"New Background",imageID:v.images[0].id,bgColor:"#FFFFFF"}),W()}),b(`${e} .list button.delete`,"click",(i,a)=>{const t=+a.closest("div.background").dataset.id;U.background(t),A()}),b(`${e} .list input.name`,"input",(i,a)=>{const t=+a.closest("div.background").dataset.id,n=x("backgrounds",t);n.name=a.value,A()}),b(`${e} .list input.bg-color`,"change",(i,a)=>{const t=+a.closest("div.background").dataset.id,n=x("backgrounds",t);let r=a.value;r.indexOf("#")===-1&&(r="#"+r),n.bgColor=r,A()}),b(`${e} .list select.image`,"change",(i,a)=>{const t=+a.closest("div.background").dataset.id,n=+a.value,r=x("backgrounds",t);r.imageID=n,A()})}function Qt(){const e="#images-tab";b(`${e} button.create`,"click",()=>{X.image(),W()}),b(`${e} .list button.delete`,"click",(t,n)=>{const r=+n.closest("div.image").dataset.id;U.image(r),A()}),b(`${e} .list input.name`,"input",(t,n)=>{const r=+n.closest("div.image").dataset.id,o=x("images",r);o.name=n.value,W()}),b(`${e} .list select.image-file`,"change",(t,n)=>{const r=+n.closest("div.image").dataset.id,o=x("images",r);o.filename=n.value,A()}),b(`${e} select.image-file-preview-select`,"change",(t,n)=>{let r=n.value;r==="none"?r="":r="/assets/images/"+r,w.imagesTab.previewImage.src=r}),b(`${e} #upload button.submit`,"click",async()=>{if(w.imagesTab.fileInput.files.length===0){i();return}const t=w.imagesTab.fileInput.files[0];let n=w.imagesTab.uploadFileName.value;n||(n=t.name),n=encodeURIComponent(n);const r="/api/upload-image?filename="+n,o=await fetch(r,{method:"POST",body:t.slice()}),g=await o.text();if(o.status!==200)console.log(o),i();else{a();const c=X.image();c.name=n.replace(".png",""),c.filename=g}W()});function i(){w.imagesTab.uploadButton.classList.add("error"),w.imagesTab.uploadButton.disabled=!0,setTimeout(()=>{w.imagesTab.uploadButton.classList.remove("error"),w.imagesTab.uploadButton.disabled=!1},1500)}function a(){w.imagesTab.uploadButton.classList.add("success"),w.imagesTab.uploadButton.disabled=!0,setTimeout(()=>{w.imagesTab.uploadButton.classList.remove("success"),w.imagesTab.uploadButton.disabled=!1},1500)}}function Yt(){const e="#tree-tab";b(`${e} li > div.content > span.text`,"click",(t,n)=>{const r=n.closest("li"),o=r.classList.toggle("collapsed"),g=+r.dataset.id,u=/dialogue/i.test(r.className)?m.tree.collapsed.dialogue:m.tree.collapsed.choices;o?u.push(g):u.splice(u.indexOf(g),1)}),b(`${e} li.dialogue > div.content > button.go-to`,"click",(t,n)=>{const r=+n.closest("li.dialogue").dataset.id;N.currentDialogueID!==r&&(N.currentDialogueID=r,ze(r),A())}),b(`${e} li.dialogue.reference > div.content > span.text`,"mouseover",(t,n)=>{const r=+n.closest("li.dialogue").dataset.id;q(`${e} li.dialogue:not(.reference)[data-id="${r}"]`).classList.add("highlight")}),b(`${e} li.dialogue.reference > div.content > span.text`,"mouseout",(t,n)=>{q(`${e} li.dialogue:not(.reference).highlight`).classList.remove("highlight")}),b(`${e} li.dialogue > div.content > button.link`,"click",(t,n)=>{m.tree.linking.finalized&&i();const r=+n.closest("li.dialogue").dataset.id;m.tree.linking.dialogueID===r?m.tree.linking.dialogueID=null:m.tree.linking.dialogueID=r,a()}),b(`${e} li.choice > div.content > button.link`,"click",(t,n)=>{m.tree.linking.finalized&&i();const r=+n.closest("li.choice").dataset.id,o=x("choices",r);m.tree.linking.choiceID===r?(m.tree.linking.choiceID=null,m.tree.linking.srcDialogueID=null):(m.tree.linking.choiceID=r,o.targetDialogueID!==null&&(m.tree.linking.srcDialogueID=o.targetDialogueID)),a()});function i(){m.tree.linking.choiceID=null,m.tree.linking.dialogueID=null,m.tree.linking.srcDialogueID=null}function a(){if(m.tree.linking.choiceID===null||m.tree.linking.dialogueID===null){m.tree.linking.finalized=!1,W();return}const t=x("choices",m.tree.linking.choiceID);t.targetDialogueID=m.tree.linking.dialogueID,m.tree.linking.finalized=!0,A()}b(`${e} > div > button.undo`,"click",(t,n)=>{const r=Object.assign({},m.tree.linking);m.tree.linking.dialogueID=r.srcDialogueID,m.tree.linking.srcDialogueID=r.dialogueID;const o=x("choices",r.choiceID);o.targetDialogueID=r.srcDialogueID,A()}),b(`${e} li.choice > div.content > button.unlink`,"click",(t,n)=>{const r=+n.closest("li.choice").dataset.id,o=x("choices",r);o.targetDialogueID=null,A()}),b(`${e} li.choice > div.content > button.create-dialogue`,"click",(t,n)=>{const r=+n.closest("li.dialogue").dataset.id,o=+n.closest("li.choice").dataset.id,g=x("dialogue",r),c=x("choices",o),u=X.dialogue(g);c.targetDialogueID=u.id,A()})}function Zt(){const e="#utilities-tab";b(`${e} button.remove-orphans`,"click",()=>{const i=v.dialogue.map(t=>t.id);i.splice(0,1);for(const t of v.choices){const n=i.indexOf(t.targetDialogueID);n>-1&&i.splice(n,1)}for(const t of i)U.dialogue(t);const a=v.choices.map(t=>t.id);for(const t of v.dialogue)for(const n of t.choices){const r=a.indexOf(n);r>-1&&a.splice(r,1)}for(const t of a)U.choice(t)}),b(`${e} button.reset-everything`,"click",async()=>{confirm("Are you sure you want to reset everything? This cannot be undone.")&&(localStorage.clear(),navigator.serviceWorker.controller.postMessage("clear-idb"))})}function en(){Xt(),Jt(),Kt(),Qt(),Yt(),Zt(),b("button#nav-back","click",()=>{Rt(),A()}),b("button#nav-next","click",()=>{Ft(),A()}),b("button#game-size","click",(a,t)=>{const n=document.querySelector("iframe"),r=document.getElementById("editor");r.classList.contains("hidden")?(n.style.width="",r.classList.remove("hidden"),t.innerHTML="&gt;"):(n.style.width="100%",r.classList.add("hidden"),t.innerHTML="&lt;")}),b("button#push","click",async(a,t)=>{t.classList.add("active"),t.disabled=!0,t.textContent="Pushing...";const n=Object.keys(v);for(const r of n)await fetch("/api/save",{method:"post",body:JSON.stringify({type:r,data:v[r]})});t.classList.remove("active"),t.textContent="Pushed",setTimeout(()=>{t.disabled=!1,t.textContent="Push changes"},750)}),b("button#save","click",async(a,t)=>{i(t)});let e=!1;b("button#clear","click",async(a,t)=>{e=!0;const n=localStorage.getItem("editor-opened-tab");localStorage.clear(),n&&localStorage.setItem("editor-opened-tab",n),t.textContent="Cleared",setTimeout(()=>{location.reload()},500)}),setInterval(i.bind(null,w.btnSave,!0),15e3),window.addEventListener("beforeunload",i.bind(null,w.btnSave,!0));function i(a,t){if(t&&e)return;const n=Object.keys(v);for(const r of n)localStorage.setItem("editor-"+r,JSON.stringify(v[r]));a.disabled=!0,a.textContent="Saved",setTimeout(()=>{a.disabled=!1,a.textContent="Save"},2500)}}const tn=document.getElementById("tabs-list");function nn(){const e=localStorage.getItem("editor-opened-tab");e&&setTimeout(()=>{const i=q(`#tabs-list span.link[data-target="${e}"]`);i&&i.click()},0),b("#tabs-list span.link","click",(i,a)=>{document.querySelector(".tab.active").classList.remove("active"),tn.querySelector(".active").classList.remove("active");const t=a.dataset.target+"-tab";document.getElementById(t).classList.add("active"),a.classList.add("active"),localStorage.setItem("editor-opened-tab",a.dataset.target),W()})}async function an(){const e=Object.keys(v),i={};let a=!1;for(const n of e){const r=localStorage.getItem("editor-"+n);r||(a=!0),i[n]=JSON.parse(r)}const t=m.devMode;a||t?(console.log("Allowing game to load data..."),await tt()):(Object.assign(v,i),console.log("Loaded data from local storage.")),console.log("Game data:",v),window.data=v}function Pe(e,i){const a=nt(e),t=i+1;switch(t){case 2:{for(const n of a.dialogue)n.ownerCharacterID=n.characterID,_e(n,"characterID","character1ID"),_e(n,"characterFrameIndex","character1FrameIndex"),n.character2ID=null,n.character2FrameIndex=null;break}case 1:{if(a.meta={version:1},a.frames)break;a.frames=[];let n=0;for(const r of a.characters){const o={id:n++,name:"Default frame",imageID:r.imageID};a.frames.push(o),r.frames=[o.id],delete r.imageID}for(const r of a.dialogue)r.characterFrameIndex=0;break}}return a.meta.version=t,a}function _e(e,i,a){const t=e[i];delete e[i],e[a]=t}const Ie=2;function rn(e){const i=on(e);if(i>Ie)throw new Error("Game Data version is newer than expected. Please go back in time and try again.");if(i===Ie)return e;let a=Pe(e,i);for(;a.meta.version<Ie;)a=Pe(a,a.meta.version);return a}function on(e){return e.meta?e.meta.version:0}const cn=["editor-opened-tab"];function sn(){const e={},i=[];for(let n=0;n<localStorage.length;n++){const r=localStorage.key(n);cn.indexOf(r)>-1||i.push(r)}if(i.length===0)return;for(const n of i)try{const r=JSON.parse(localStorage.getItem(n)),o=n.replace("editor-","");e[o]=r}catch{return}const a=rn(e);if(console.log("Migrated local data to new version. Saving..."),a===e)return;const t=Object.keys(a);for(const n of t){const r="editor-"+n,o=JSON.stringify(a[n]);localStorage.setItem(r,o)}console.log("Saved.")}var ln=function(){return!!(window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))},ye;typeof window<"u"&&(typeof Promise<"u"?ye=new Promise(function(e){return window.addEventListener("load",e)}):ye={then:function(e){return window.addEventListener("load",e)}});function un(e,i){i===void 0&&(i={});var a=i.registrationOptions;a===void 0&&(a={}),delete i.registrationOptions;var t=function(n){for(var r=[],o=arguments.length-1;o-- >0;)r[o]=arguments[o+1];i&&i[n]&&i[n].apply(i,r)};"serviceWorker"in navigator&&ye.then(function(){ln()?(dn(e,t,a),navigator.serviceWorker.ready.then(function(n){t("ready",n)}).catch(function(n){return ie(t,n)})):(Ke(e,t,a),navigator.serviceWorker.ready.then(function(n){t("ready",n)}).catch(function(n){return ie(t,n)}))})}function ie(e,i){navigator.onLine||e("offline"),e("error",i)}function Ke(e,i,a){navigator.serviceWorker.register(e,a).then(function(t){if(i("registered",t),t.waiting){i("updated",t);return}t.onupdatefound=function(){i("updatefound",t);var n=t.installing;n.onstatechange=function(){n.state==="installed"&&(navigator.serviceWorker.controller?i("updated",t):i("cached",t))}}}).catch(function(t){return ie(i,t)})}function dn(e,i,a){fetch(e).then(function(t){t.status===404?(i("error",new Error("Service worker not found at "+e)),He()):t.headers.get("content-type").indexOf("javascript")===-1?(i("error",new Error("Expected "+e+" to have javascript content-type, but received "+t.headers.get("content-type"))),He()):Ke(e,i,a)}).catch(function(t){return ie(i,t)})}function He(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}).catch(function(e){return ie(emit,e)})}function fn(){return new Promise((e,i)=>{const a=console.log.bind(console),t=console.error.bind(console);un(at("./service-worker.js"),{registrationOptions:{scope:"./",type:"module"},registered(n){a("Service worker has been registered.")},ready(n){a("Service worker is active."),e()},cached(n){a("Content has been cached for offline use.")},updatefound(n){a("New content is downloading.")},updated(n){a("New content is available; please refresh.")},offline(){a("No internet connection found. App is running in offline mode.")},error(n){t("Error during service worker registration:",n),i()}})})}window.addEventListener("load",async()=>{if(window!==window.top)return;await fn(),sn(),await an(),Gt(),N.currentDialogueID=0,m.history.push(0),m.currentHistoryIndex=0,it(),Bt(),rt(),en(),nn(),A();const e=await(await fetch("/api/version")).text();document.getElementById("version").textContent="v"+e,m.devMode&&document.getElementById("update-time").classList.remove("hidden")});
